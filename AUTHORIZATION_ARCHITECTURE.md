```
╔═══════════════════════════════════════════════════════════════════════════════╗
║                    🔐 СИСТЕМА АВТОРИЗАЦИИ - АРХИТЕКТУРА                      ║
╚═══════════════════════════════════════════════════════════════════════════════╝

┌─────────────────────────────────────────────────────────────────────────────┐
│                            ТОЧКА ВХОДА: main()                              │
│                                                                               │
│  1. Запускается приложение QApplication                                      │
│  2. Показывается окно входа LoginDialog                                      │
│  3. После успешной авторизации → открывается MainWindow                      │
└─────────────────────────────────────────────────────────────────────────────┘
                                    ↓
┌─────────────────────────────────────────────────────────────────────────────┐
│                        📝 ОКНО ВХОДА (LoginDialog)                           │
│  ┌──────────────────────────────────────────────────────────────────────┐   │
│  │  Вкладка 1: 🔑 Вход                                                   │   │
│  │  ┌─────────────────────────────────────────────────────────────────┐ │   │
│  │  │ Имя пользователя: [admin, user1, user2, ...]              │ │   │
│  │  │ Пароль: [•••••••••]                                       │ │   │
│  │  │                                                             │ │   │
│  │  │ [🔓 Вход]                                                  │ │   │
│  │  │                                                             │ │   │
│  │  │ Подсказка: admin / admin                                  │ │   │
│  │  └─────────────────────────────────────────────────────────────────┘ │   │
│  │                                                                        │   │
│  │  Вкладка 2: ✍️ Новый пользователь                                    │   │
│  │  ┌─────────────────────────────────────────────────────────────────┐ │   │
│  │  │ Выберите сотрудника: [▼ Иванов Иван Иванович]          │ │   │
│  │  │ Имя пользователя: [user1] (автоматическое)             │ │   │
│  │  │ Пароль: [user1] (совпадает с именем)                  │ │   │
│  │  │                                                             │ │   │
│  │  │ [✅ Создать аккаунт]                                      │ │   │
│  │  │                                                             │ │   │
│  │  │ Заметка: Создаются аккаунты user1, user2, user3 и т.д.  │ │   │
│  │  └─────────────────────────────────────────────────────────────────┘ │   │
│  └──────────────────────────────────────────────────────────────────────┘   │
│                                                                               │
│  Проверка в БД:                                                              │
│  - SELECT FROM Users WHERE username = ? AND is_active = 1                   │
│  - Проверка хеша пароля SHA-256                                             │
│  - Возврат объекта current_user с информацией о роли и сотруднике          │
└─────────────────────────────────────────────────────────────────────────────┘
                                    ↓
                         Сигнал: login_successful
                                    ↓
┌─────────────────────────────────────────────────────────────────────────────┐
│                       🏠 ГЛАВНОЕ ОКНО (MainWindow)                           │
│                                                                               │
│  Получает: current_user = {                                                  │
│    'user_id': 1,                                                             │
│    'username': 'admin',                                                      │
│    'role': 'admin',                                                          │
│    'employee_id': None,                                                      │
│    'full_name': 'Administrator'                                              │
│  }                                                                            │
│                                                                               │
│  Отображение вкладок в зависимости от роли:                                │
│  ┌──────────────────────────────────────────────────────────────────────┐   │
│  │                                                                        │   │
│  │  if role == 'admin':                                                 │   │
│  │    ✅ 🏠 Панель управления    ✅ 📋 Каталог активов                  │   │
│  │    ✅ 🔄 Операции             ✅ 📬 Запросы                          │   │
│  │    ✅ 📊 Отчеты                                                       │   │
│  │                                                                        │   │
│  │  elif role == 'user':                                                │   │
│  │    ✅ 🏠 Панель управления                                            │   │
│  │    ✅ 🔄 Операции             ❌ 📋 Каталог активов (скрыта)       │   │
│  │    ✅ 📊 Отчеты               ❌ 📬 Запросы (скрыта)               │   │
│  │                                                                        │   │
│  └──────────────────────────────────────────────────────────────────────┘   │
└─────────────────────────────────────────────────────────────────────────────┘


╔═══════════════════════════════════════════════════════════════════════════════╗
║               ДИАГРАММА ОПЕРАЦИЙ И ПРАВ ДОСТУПА                              ║
╚═══════════════════════════════════════════════════════════════════════════════╝

┌─────────────────────────────┬──────────────┬──────────────┐
│        ОПЕРАЦИЯ             │   ADMIN      │    USER      │
├─────────────────────────────┼──────────────┼──────────────┤
│ 📋 Просмотр каталога        │     ✅       │     ❌       │
│ ➕ Добавить актив           │     ✅       │     ❌       │
│ ✏️ Редактировать актив      │     ✅       │     ❌       │
│ 🗑️ Удалить актив           │     ✅       │     ❌       │
│ 📥 Импорт из Excel          │     ✅       │     ❌       │
│ 📤 Выдать актив (прямое)    │     ✅       │     ❌       │
│ 📥 Вернуть актив            │     ✅       │     ✅       │
│ 📝 Запросить актив          │     ✅       │     ✅       │
│ 📬 Одобрить/отклонить       │     ✅       │     ❌       │
│ 📊 Все отчеты               │     ✅       │     ✅       │
│ 💾 Экспорт данных           │     ✅       │     ✅       │
│ 🏠 Панель управления        │     ✅       │     ✅       │
└─────────────────────────────┴──────────────┴──────────────┘


╔═══════════════════════════════════════════════════════════════════════════════╗
║                      СИСТЕМЫ УПРАВЛЕНИЯ ЗАПРОСАМИ                            ║
╚═══════════════════════════════════════════════════════════════════════════════╝

ПОТОК ЗАПРОСА НА ВЫДАЧУ АКТИВА:

┌──────────────────────────────────────────────────────────────────────────────┐
│                         1️⃣ ПОЛЬЗОВАТЕЛЬ СОЗДАЕТ ЗАПРОС                       │
├──────────────────────────────────────────────────────────────────────────────┤
│                                                                                │
│  Шаги:                                                                        │
│  1. Нажимает "📝 Запросить актив"                                            │
│  2. Выбирает актив из списка доступных                                      │
│  3. Устанавливает дату планового возврата                                   │
│  4. Добавляет примечание (опционально)                                       │
│  5. Нажимает "✅ Отправить запрос"                                           │
│                                                                                │
│  Результат:                                                                   │
│  INSERT INTO Asset_Requests (asset_id, employee_id, request_date, ...) →    │
│  status = 'pending'                                                          │
│                                                                                │
└──────────────────────────────────────────────────────────────────────────────┘
                                     ↓
┌──────────────────────────────────────────────────────────────────────────────┐
│                         2️⃣ АДМИНИСТРАТОР ПРОСМАТРИВАЕТ                      │
├──────────────────────────────────────────────────────────────────────────────┤
│                                                                                │
│  Вкладка: 📬 Запросы                                                          │
│  Таблица со всеми запросами:                                                 │
│                                                                                │
│  ┌─────────────────────────────────────────────────────────────────────────┐ │
│  │ ID │ Актив │ Сотрудник │ Дата │ Статус │ Примечание │ [✅] [❌] [🔄] │ │
│  │ 1  │ Шур... │ Иванов И. │ ... │ pending │ Нужно на... │                 │ │
│  │ 2  │ Муль... │ Петров П. │ ... │ pending │ Не работ... │                 │ │
│  └─────────────────────────────────────────────────────────────────────────┘ │
│                                                                                │
│  Выбирает запрос и нажимает:                                                 │
│  - ✅ Одобрить  → переходит на шаг 3                                        │
│  - ❌ Отклонить → переходит на шаг 4                                        │
│                                                                                │
└──────────────────────────────────────────────────────────────────────────────┘
                                     ↓
                    ┌────────────────────────────────────┐
                    │                                    │
        ✅ ОДОБРИТЬ │                                    │ ❌ ОТКЛОНИТЬ
                    │                                    │
                    ↓                                    ↓
        ┌────────────────────────┐        ┌─────────────────────────┐
        │   3️⃣ ОДОБРЕНИЕ ЗАПРОСА  │        │  4️⃣ ОТКЛОНЕНИЕ ЗАПРОСА  │
        ├────────────────────────┤        ├─────────────────────────┤
        │                        │        │                         │
        │ Проверка:              │        │ UPDATE Asset_Requests   │
        │ - Есть ли активы?      │        │ SET status='rejected',  │
        │ - quantity > 0?        │        │ approved_by=?,          │
        │                        │        │ approved_at=?           │
        │ Действия:              │        │                         │
        │ 1. INSERT Usage_History│        │ Запрос теперь отклонен  │
        │    type='выдача'       │        │ Актив остается на складе │
        │ 2. UPDATE Assets:      │        │                         │
        │    quantity -= 1       │        │ Результат:              │
        │    status=Выдан/...    │        │ status = 'rejected'     │
        │ 3. UPDATE Asset_       │        │                         │
        │    Requests:           │        │                         │
        │    status='approved'   │        └─────────────────────────┘
        │                        │
        │ Результат:             │
        │ - Актив выдан          │
        │ - История создана      │
        │ - Запрос одобрен       │
        │ - Уведомление админу   │
        │                        │
        └────────────────────────┘
                    ↓
        ┌────────────────────────┐
        │ 5️⃣ ПОЛЬЗОВАТЕЛЬ ВИДИТ   │
        │ ВЫДАННЫЙ АКТИВ         │
        │                        │
        │ Актив теперь видно:    │
        │ - В истории операций   │
        │ - На панели управления │
        │ (статистика обновлена) │
        │                        │
        │ Может нажать:          │
        │ "📥 Вернуть актив"     │
        └────────────────────────┘


╔═══════════════════════════════════════════════════════════════════════════════╗
║                         СТРУКТУРА БАЗЫ ДАННЫХ                                ║
╚═══════════════════════════════════════════════════════════════════════════════╝

┌─────────────────────────────────────────────────────────────────────────────┐
│ Таблица: Users                                                               │
├─────────────────────────────────────────────────────────────────────────────┤
│ user_id (PK)        INTEGER PRIMARY KEY AUTOINCREMENT                       │
│ username (UNIQUE)   VARCHAR(50) NOT NULL                                    │
│ password            VARCHAR(255) NOT NULL (SHA-256 хеш)                    │
│ employee_id (FK)    INTEGER → Employees.employee_id                        │
│ role                VARCHAR(20) DEFAULT 'user' (admin, user)               │
│ is_active           BOOLEAN DEFAULT 1                                       │
│ created_at          DATETIME DEFAULT CURRENT_TIMESTAMP                      │
└─────────────────────────────────────────────────────────────────────────────┘

┌─────────────────────────────────────────────────────────────────────────────┐
│ Таблица: Asset_Requests                                                      │
├─────────────────────────────────────────────────────────────────────────────┤
│ request_id (PK)         INTEGER PRIMARY KEY AUTOINCREMENT                   │
│ asset_id (FK)           INTEGER → Assets.asset_id NOT NULL                 │
│ employee_id (FK)        INTEGER → Employees.employee_id NOT NULL           │
│ request_date            DATETIME NOT NULL                                    │
│ planned_return_date     DATE                                                 │
│ notes                   TEXT                                                 │
│ status                  VARCHAR(20) DEFAULT 'pending'                       │
│                         (pending, approved, rejected)                       │
│ approved_by (FK)        INTEGER → Users.user_id                            │
│ approved_at             DATETIME                                             │
└─────────────────────────────────────────────────────────────────────────────┘

┌─────────────────────────────────────────────────────────────────────────────┐
│ Таблица: Employees (существовала ранее, добавлено FK на Users)              │
├─────────────────────────────────────────────────────────────────────────────┤
│ employee_id (PK)       INTEGER PRIMARY KEY AUTOINCREMENT                    │
│ last_name              VARCHAR(100) NOT NULL                                 │
│ first_name             VARCHAR(100) NOT NULL                                 │
│ patronymic             VARCHAR(100)                                          │
│ position_id (FK)       INTEGER → Positions.position_id                     │
│ phone                  VARCHAR(20)                                           │
│ email                  VARCHAR(100)                                          │
│ (Связь с Users: один сотрудник → один пользователь)                       │
└─────────────────────────────────────────────────────────────────────────────┘

СВЯЗИ (FOREIGN KEYS):
════════════════════
Users.employee_id  ──→ Employees.employee_id
Asset_Requests.asset_id  ──→ Assets.asset_id
Asset_Requests.employee_id  ──→ Employees.employee_id
Asset_Requests.approved_by  ──→ Users.user_id


╔═══════════════════════════════════════════════════════════════════════════════╗
║                        ПРИМЕРЫ SQL ЗАПРОСОВ                                  ║
╚═══════════════════════════════════════════════════════════════════════════════╝

1️⃣ СОЗДАНИЕ ПОЛЬЗОВАТЕЛЯ:
   INSERT INTO Users (username, password, employee_id, role, created_at)
   VALUES ('user1', 'a665a45920422f9d417e4867efdc4fb8a04a1f3fff1fa07e998e86f7f7a27ae3', 1, 'user', NOW())

2️⃣ ПРОВЕРКА ПАРОЛЯ ПРИ ВХОДЕ:
   SELECT * FROM Users 
   WHERE username = 'admin' 
     AND password = 'a665a45920422f9d417e4867efdc4fb8a04a1f3fff1fa07e998e86f7f7a27ae3'
     AND is_active = 1

3️⃣ СОЗДАНИЕ ЗАПРОСА НА ВЫДАЧУ:
   INSERT INTO Asset_Requests (asset_id, employee_id, request_date, planned_return_date, notes, status)
   VALUES (1, 1, NOW(), '2025-01-15', 'Нужно для работы', 'pending')

4️⃣ ПОЛУЧЕНИЕ ВСЕХ ЗАПРОСОВ ДЛЯ АДМИНИСТРАТОРА:
   SELECT ar.request_id, a.name, e.last_name || ' ' || e.first_name, 
          ar.request_date, ar.status, ar.notes
   FROM Asset_Requests ar
   JOIN Assets a ON ar.asset_id = a.asset_id
   JOIN Employees e ON ar.employee_id = e.employee_id
   ORDER BY ar.request_date DESC

5️⃣ ОДОБРЕНИЕ ЗАПРОСА:
   UPDATE Asset_Requests 
   SET status = 'approved', approved_by = 1, approved_at = NOW()
   WHERE request_id = 1

6️⃣ ОТКЛОНЕНИЕ ЗАПРОСА:
   UPDATE Asset_Requests 
   SET status = 'rejected', approved_by = 1, approved_at = NOW()
   WHERE request_id = 1


╔═══════════════════════════════════════════════════════════════════════════════╗
║                       ХЕШИРОВАНИЕ ПАРОЛЕЙ (SHA-256)                          ║
╚═══════════════════════════════════════════════════════════════════════════════╝

Пример:
────────
Пароль: "user1"
Хеш:    "c645e20c6c0faf440285f6ff3e2098bf0174381ebde521ff1b4e147f2039d907"

Проверка при входе:
1. Пользователь вводит пароль: "user1"
2. Система хеширует: SHA256("user1")
3. Сравнивает с хешем в БД
4. Если совпадает → вход успешен

! ВАЖНО: Текущая реализация использует SHA-256
  Для production рекомендуется: bcrypt или argon2
```
