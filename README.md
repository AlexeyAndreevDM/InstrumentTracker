# InstrumentTracker

Система учета инструментов и расходников для АО КОНСИСТ-ОС — настольное приложение на Python и PyQt6 для управления инвентарем, отслеживания выдачи и возврата активов с многопользовательским доступом.

## Описание

InstrumentTracker — это полнофункциональное десктопное приложение для управления инструментами, расходными материалами и оборудованием на предприятии. Система обеспечивает контроль за выдачей активов сотрудникам, отслеживает сроки возврата, предоставляет отчеты и уведомления о просроченных возвратах.

## Основные возможности

### Управление активами
- Каталог инструментов и расходников с детальным описанием
- Типы активов, модели, серийные номера
- Управление местоположением и количеством
- Импорт данных из Excel
- Экспорт каталога в CSV/Excel

### Учет операций
- Выдача активов сотрудникам с указанием планируемой даты возврата
- Возврат активов с автоматическим обновлением статусов
- История всех операций с фильтрацией
- Запросы на выдачу активов от пользователей

### Система уведомлений
- Автоматическая проверка сроков возврата (каждые 60 минут)
- Визуальные уведомления в стиле macOS
- Email-уведомления администратору о просрочках
- Индикация статусов: "Просрочено", "Возвращено с опозданием"

### Многопользовательский режим
- Роли: Администратор и Пользователь
- Авторизация с хешированием паролей (SHA-256)
- Персональные дашборды для пользователей
- Управление учетными записями администратором

### Отчеты
- Отчет по просрочкам с детализацией
- Отчет по использованию активов
- Инвентаризационная ведомость
- Экспорт отчетов в CSV и Excel

### Интерфейс
- Темная и светлая темы оформления
- Горячие клавиши для быстрого доступа
- Адаптивный дизайн с вкладками
- Кроссплатформенность (Windows, macOS, Linux)

## Технологии

- **Python 3.11+** — основной язык программирования
- **PyQt6** — графический интерфейс
- **SQLite3** — локальная база данных с WAL-режимом
- **openpyxl** — работа с Excel файлами
- **PyInstaller** — сборка исполняемых файлов

## Требования

- Python 3.11 или выше
- PyQt6 6.5.0+
- openpyxl 3.1.2+
- PyInstaller 6.0.0+ (только для сборки)

## Установка и запуск

### Для разработки

1. Клонируйте репозиторий:
```bash
git clone https://github.com/yourusername/InstrumentTracker.git
cd InstrumentTracker
```

2. Создайте виртуальное окружение:
```bash
python -m venv .venv
source .venv/bin/activate  # Linux/macOS
.venv\Scripts\activate     # Windows
```

3. Установите зависимости:
```bash
pip install -r requirements.txt
```

4. Запустите приложение:
```bash
python main.py
```

### Первый запуск

При первом запуске база данных создается автоматически с тестовыми данными:
- 4 должности
- 3 сотрудника
- 4 типа активов
- 4 местоположения
- 4 тестовых актива

**Вход в систему:**
- Логин: `admin`
- Пароль: `admin`

## Сборка приложения

### Windows

1. Установите PyInstaller:
```bash
pip install pyinstaller
```

2. Соберите приложение:
```bash
pyinstaller InstrumentTracker_Windows.spec --clean -y
```

3. Готовое приложение в папке `dist/InstrumentTracker/`

Подробная инструкция: [BUILD_WINDOWS.md](BUILD_WINDOWS.md)

### macOS

1. Установите PyInstaller:
```bash
pip install pyinstaller
```

2. Соберите приложение:
```bash
pyinstaller InstrumentTracker.spec --clean -y
```

3. Готовое приложение: `dist/InstrumentTracker.app`

Подробная инструкция: [BUILD_MACOS.md](BUILD_MACOS.md)

## Структура проекта

```
InstrumentTracker/
├── main.py                          # Точка входа, главное окно приложения
├── database/
│   ├── db_manager.py                # Singleton менеджер БД
│   └── db_core.py                   # Создание схемы и тестовых данных
├── views/
│   ├── login_dialog.py              # Диалог авторизации и регистрации
│   ├── asset_dialog.py              # Добавление активов
│   ├── edit_asset_dialog.py         # Редактирование активов
│   ├── issue_dialog.py              # Выдача активов
│   └── return_dialog.py             # Возврат активов
├── notification_manager.py          # Система уведомлений
├── email_notifier.py                # Email-уведомления
├── theme_manager.py                 # Управление темами
├── audit_logger.py                  # Логирование действий
├── pictures/                        # Иконки и изображения
├── md files/                        # Документация
├── InstrumentTracker.spec           # Spec для macOS
├── InstrumentTracker_Windows.spec   # Spec для Windows
└── requirements.txt                 # Зависимости Python
```

## База данных

### Таблицы

- **Positions** — должности сотрудников
- **Employees** — справочник сотрудников
- **Asset_Types** — типы активов
- **Locations** — местоположения активов
- **Assets** — каталог активов
- **Usage_History** — история операций
- **Users** — учетные записи пользователей
- **Asset_Requests** — запросы на выдачу

### Расположение БД

- **Разработка**: `inventory.db` в корне проекта
- **Windows (собранное)**: `%APPDATA%\InstrumentTracker\inventory.db`
- **macOS (собранное)**: `~/Library/Application Support/InstrumentTracker/inventory.db`
- **Linux (собранное)**: `~/.local/share/InstrumentTracker/inventory.db`

### Утилиты

```bash
# Проверка структуры БД
python check_db.py

# Пересоздание БД с тестовыми данными
python reset_db.py
```

## Горячие клавиши

### Меню
- **Ctrl+E** — Экспорт данных
- **Ctrl+Q** — Выход
- **Ctrl+D** — Темная тема
- **Ctrl+L** — Светлая тема
- **F5** — Обновить
- **F1** — Руководство пользователя

### Вкладка "Активы" (только администратор)
- **Ctrl+N** — Добавить новый актив
- **Ctrl+E** — Редактировать актив
- **Delete** — Удалить актив
- **Ctrl+I** — Импорт из Excel

### Вкладка "Операции"
- **Ctrl+Shift+I** — Выдать актив (только администратор)
- **Ctrl+Shift+R** — Вернуть актив
- **Ctrl+Shift+A** — Запросить актив
- **F5** — Обновить историю

Полный список: [SHORTCUTS.md](SHORTCUTS.md)

## Настройка Email-уведомлений

1. Создайте пароль приложения для Gmail (не основной пароль аккаунта)
2. Откройте профиль пользователя в приложении
3. Заполните поля:
   - Email отправителя (ваш Gmail)
   - Пароль приложения
   - Email администратора (куда приходят уведомления)
4. Протестируйте отправку

Подробная инструкция: [EMAIL_SETUP.md](EMAIL_SETUP.md)

## Использование

### Для администратора

1. Войдите как `admin` / `admin`
2. Добавьте сотрудников в каталоге активов
3. Заполните каталог инструментов и расходников
4. Выдавайте активы через "Операции → Выдать"
5. Принимайте возвраты через "Операции → Вернуть"
6. Просматривайте отчеты во вкладке "Отчеты"

### Для пользователя

1. Зарегистрируйтесь в системе (выберите своего сотрудника)
2. Просматривайте активы в каталоге
3. Создавайте запросы на выдачу через "Операции → Запросить"
4. Возвращайте активы через "Операции → Вернуть"
5. Следите за своими операциями на панели управления

## Разработка

### Запуск в режиме разработки

```bash
python main.py
```

### Тестирование

```bash
# Тест уведомлений
python test_notifications.py

# Тест email
python test_email.py

# Тест статусов активов
python test_asset_status.py
```

### Добавление новых функций

1. Модели данных → `database/db_manager.py`
2. UI диалоги → `views/`
3. Основная логика → `main.py`
4. Обновите схему БД в `database/db_core.py` и `database/db_manager.py`

## Документация

- [BUILD_README.md](BUILD_README.md) — Обзор процесса сборки
- [BUILD_WINDOWS.md](BUILD_WINDOWS.md) — Сборка для Windows
- [BUILD_MACOS.md](BUILD_MACOS.md) — Сборка для macOS
- [EMAIL_SETUP.md](EMAIL_SETUP.md) — Настройка email-уведомлений
- [SHORTCUTS.md](SHORTCUTS.md) — Горячие клавиши
- [md files/AUTHORIZATION_GUIDE.md](md%20files/AUTHORIZATION_GUIDE.md) — Руководство по авторизации
- [md files/IMPORT_GUIDE.md](md%20files/IMPORT_GUIDE.md) — Импорт данных из Excel

## Troubleshooting

### База данных не создается
```bash
python reset_db.py
```

### Ошибка "no such table: Users"
Обновите структуру БД:
```bash
rm inventory.db
python reset_db.py
```

### Email не отправляются
1. Проверьте пароль приложения Gmail (не основной пароль)
2. Убедитесь что включена двухфакторная аутентификация
3. Проверьте настройки в профиле пользователя

### Windows: Ошибка при запуске
- Установите Visual C++ Redistributable
- Запустите через cmd для просмотра логов

## Лицензия

MIT License

Copyright (c) 2025 АО КОНСИСТ-ОС

## Контакты

Для вопросов и предложений:
- Email: andreevaleksej477@gmail.com
- GitHub Issues: [Issues](https://github.com/yourusername/InstrumentTracker/issues)

## Благодарности

Разработано для автоматизации учета инструментов и расходников в АО КОНСИСТ-ОС.
